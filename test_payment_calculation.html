<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Perhitungan Pembayaran Piutang</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .summary {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .summary div {
            margin-bottom: 10px;
        }

        .amount {
            font-weight: bold;
            color: #2563eb;
        }

        .error {
            color: #dc2626;
            margin-top: 5px;
        }

        .test-cases {
            margin-top: 30px;
        }

        .test-case {
            background: #e5f3ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }

        h1,
        h2 {
            color: #1f2937;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Test Perhitungan Pembayaran Piutang</h1>

        <div x-data="{
            currentSisaPiutang: 5000000,
            totalPiutang: 10000000,
            sisaSetelahPembayaran: 5000000,
            jumlahPembayaran: 0,
            isInvoiceContext: true,
            showValidationError: false,
            errorMessage: '',
            
            formatRupiah(angka) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(angka);
            },
            
            updateJumlah() {
                let amount = parseFloat(this.jumlahPembayaran || 0);
                if (isNaN(amount)) amount = 0;
                
                if (this.isInvoiceContext) {
                    this.sisaSetelahPembayaran = this.currentSisaPiutang - amount;
                } else {
                    this.sisaSetelahPembayaran = this.totalPiutang - amount;
                }
                this.validatePayment();
            },
            
            validatePayment() {
                let amount = parseFloat(this.jumlahPembayaran || 0);
                if (this.isInvoiceContext && amount > this.currentSisaPiutang) {
                    this.showValidationError = true;
                    this.errorMessage = `Jumlah pembayaran tidak boleh melebihi sisa piutang (${this.formatRupiah(this.currentSisaPiutang)})`;
                    return false;
                }
                if (amount <= 0) {
                    this.showValidationError = true;
                    this.errorMessage = 'Jumlah pembayaran harus lebih dari 0';
                    return false;
                }
                this.showValidationError = false;
                this.errorMessage = '';
                return true;
            },
            
            setTestCase(totalPiutang, sisaPiutang, isInvoice) {
                this.totalPiutang = totalPiutang;
                this.currentSisaPiutang = sisaPiutang;
                this.isInvoiceContext = isInvoice;
                this.jumlahPembayaran = 0;
                this.updateJumlah();
            }
        }">
            <div class="form-group">
                <label>Konteks Pembayaran:</label>
                <select x-model="isInvoiceContext" @change="updateJumlah()">
                    <option :value="true">Pembayaran dari Invoice Spesifik</option>
                    <option :value="false">Pembayaran Umum (Tanpa Invoice)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Total Piutang Invoice:</label>
                <input type="number" x-model="totalPiutang" @input="updateJumlah()" min="0">
            </div>

            <div class="form-group">
                <label>Sisa Piutang yang Belum Dibayar:</label>
                <input type="number" x-model="currentSisaPiutang" @input="updateJumlah()" min="0">
            </div>

            <div class="form-group">
                <label>Jumlah Pembayaran:</label>
                <input type="number" x-model="jumlahPembayaran" @input="updateJumlah()" min="0" step="0.01">
                <div x-show="showValidationError" class="error" x-text="errorMessage"></div>
            </div>

            <div class="summary">
                <h3>Ringkasan Perhitungan:</h3>
                <div>Total Piutang Invoice: <span class="amount" x-text="formatRupiah(totalPiutang)"></span></div>
                <div>Sisa Tagihan Belum Dibayar: <span class="amount" x-text="formatRupiah(currentSisaPiutang)"></span>
                </div>
                <div>Jumlah Pembayaran Ini: <span class="amount" x-text="formatRupiah(jumlahPembayaran)"></span></div>
                <div style="border-top: 1px solid #ccc; padding-top: 10px; margin-top: 10px;">
                    <strong>Sisa Setelah Pembayaran Ini: <span class="amount"
                            x-text="formatRupiah(sisaSetelahPembayaran)"></span></strong>
                </div>
                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                    Konteks: <span x-text="isInvoiceContext ? 'Invoice Spesifik' : 'Pembayaran Umum'"></span>
                </div>
            </div>

            <div class="test-cases">
                <h2>Test Cases</h2>

                <div class="test-case">
                    <h3>Test Case 1: Invoice dengan Uang Muka</h3>
                    <p><strong>Skenario:</strong> Invoice Rp 10.000.000, uang muka Rp 3.000.000 sudah diterapkan, sisa
                        Rp 7.000.000</p>
                    <button @click="setTestCase(10000000, 7000000, true)">Load Test Case 1</button>
                    <p><em>Ekspektasi: Pembayaran Rp 2.000.000 → Sisa = Rp 5.000.000</em></p>
                </div>

                <div class="test-case">
                    <h3>Test Case 2: Invoice Tanpa Uang Muka</h3>
                    <p><strong>Skenario:</strong> Invoice Rp 5.000.000, belum ada pembayaran</p>
                    <button @click="setTestCase(5000000, 5000000, true)">Load Test Case 2</button>
                    <p><em>Ekspektasi: Pembayaran Rp 1.500.000 → Sisa = Rp 3.500.000</em></p>
                </div>

                <div class="test-case">
                    <h3>Test Case 3: Invoice dengan Pembayaran Parsial</h3>
                    <p><strong>Skenario:</strong> Invoice Rp 8.000.000, sudah dibayar Rp 3.000.000, sisa Rp 5.000.000
                    </p>
                    <button @click="setTestCase(8000000, 5000000, true)">Load Test Case 3</button>
                    <p><em>Ekspektasi: Pembayaran Rp 2.500.000 → Sisa = Rp 2.500.000</em></p>
                </div>

                <div class="test-case">
                    <h3>Test Case 4: Pembayaran Lebih dari Sisa</h3>
                    <p><strong>Skenario:</strong> Invoice dengan sisa Rp 1.000.000, coba bayar Rp 1.500.000</p>
                    <button
                        @click="setTestCase(3000000, 1000000, true); jumlahPembayaran = 1500000; updateJumlah()">Load
                        Test Case 4</button>
                    <p><em>Ekspektasi: Error validasi muncul</em></p>
                </div>
            </div>
        </div>
    </div>
</body>

</html>